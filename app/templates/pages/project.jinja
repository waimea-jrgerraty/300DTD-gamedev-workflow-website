{#=====================================================
  Home page
  - Hero style greeting banner
  - List of things passed in as 'things' array
  - Form for adding a new thing
=====================================================#}
{% extends "pages/base.jinja" %}
{% block title %}
    TaskForge - {{ project.name }}
{% endblock title %}
{% block nav_left %}
    {% if project.owner == session.userid %}
        <li>
            <button id="p-open-add-user" data-project-id="{{ project.id }}">
                <span class="material-symbols-outlined">group_add</span>
            </button>
        </li>
        <dialog id="p-add-user-modal">
            <article>
                <header>
                    <h3>Add user to project</h3>
                </header>
                <input id="p-member-input"
                       type="text"
                       placeholder="Type a username..."
                       autocomplete="off">
                <output id="p-add-user-error" role="status"></output>
                <footer>
                    <button id="p-cancel-add-user" class="secondary">Cancel</button>
                    <button id="p-confirm-add-user">Add</button>
                </footer>
            </article>
        </dialog>
        <script src="{{ url_for('static', filename='js/project_add_user_modal.js') }}"></script>
    {% endif %}
{% endblock nav_left %}
{% block nav_centre %}
    <li>
        <h3>
            <span class="weak">{{ project.name }}</span>
        </h3>
    </li>
{% endblock nav_centre %}
{% block content %}
    {# New task form #}
    <button id="openModalBtn" class="floating-button">
        <span class="material-symbols-outlined">add_2</span>
    </button>
    <div id="projectModal" class="modal glass">
        <div class="modal-content">
            <span id="closeModalBtn" class="close-button">×</span>
            <h2>Create New Task</h2>
            <form action="/task" method="post">
                <input type="hidden" name="project" value="{{ project.id }}">
                <input type="hidden" name="category" value="{{ category.id }}">
                {# This value will need to be changed by javascript for the full version #}
                <input type="hidden" name="group" value="9">
                <label for="taskName">
                    Task Name <span class="required">*</span>
                </label>
                <input type="text" id="taskName" name="name" autocomplete="off" required>
                <label for="description">Description</label>
                <textarea id="description" name="description" rows="4" placeholder="..."></textarea>
                <label for="priority">
                    Priority <span class="required">*</span>
                </label>
                <select name="priority" id="priority" aria-label="Priority">
                    <option selected value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
                <label for="dueDate">Due Date</label>
                <input type="date" id="dueDate" name="deadline">
                <button type="submit" class="submit-btn">Create</button>
            </form>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/modal.js') }}"></script>
    <div id="main">
        <div id="categories"></div>
        <div id="taskPanel">
            {# TODO: Proper grouping #}
            <article class="group">
                <header>
                    <h2>Tasks</h2>
                </header>
                {% for task in tasks %}
                    <a class="task priority-{{ task.priority }}"
                       href="/project/{{ project.id }}/category/{{ category.id }}/task/{{ task.task_id }}">
                        <article>
                            <h3>{{ task.task_name }}</h3>
                            <div class="taskFooter">
                                <div role="group">
                                    {% if task.task_description %}
                                        <span class="material-symbols-outlined" title="Has Description">description</span>
                                    {% endif %}
                                    <div class="userIcons">
                                        {% set users = task.assigned_users | from_json %}
                                        {% if users %}
                                            {% for user in users[:3] %}
                                                <img src="/user/{{ user.id }}/icon"
                                                     alt="{{ user.username }}"
                                                     class="user-icon"
                                                     height="64"
                                                     width="64"
                                                     aria-label="{{ user.username }}">
                                            {% endfor %}
                                            {% if users|length > 3 %}<span class="ellipsis">…</span>{% endif %}
                                        {% else %}
                                            <span class="no-users">No users assigned</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </article>
                    </a>
                {% endfor %}
            </article>
        </div>
    </div>
{% endblock content %}
