{#=====================================================
  Home page
  - Hero style greeting banner
  - List of things passed in as 'things' array
  - Form for adding a new thing
=====================================================#}
{% extends "pages/base.jinja" %}
{% block title %}
    TaskForge - {{ project.name }}
{% endblock title %}
{% block nav_centre %}
    <h3>
        <span class="weak">/ {{ project.name }}</span>
    </h3>
{% endblock nav_centre %}
{% block content %}
    {# New task form #}
    <button id="openModalBtn" class="floating-button">
        <span class="material-symbols-outlined">add_2</span>
    </button>
    <div id="projectModal" class="modal glass">
        <div class="modal-content">
            <span id="closeModalBtn" class="close-button">×</span>
            <h2>Create New Task</h2>
            <form action="/task" method="post">
                <input type="hidden" name="project" value="{{ project.id }}">
                <input type="hidden" name="category" value="{{ category.id }}">
                {# This value will need to be changed by javascript for the full version #}
                <input type="hidden" name="group" value="9">
                <label for="taskName">
                    Task Name <span class="required">*</span>
                </label>
                <input type="text" id="taskName" name="name" autocomplete="off" required>
                <label for="description">Description</label>
                <textarea id="description" name="description" rows="4" placeholder="..."></textarea>
                <label for="priority">
                    Priority <span class="required">*</span>
                </label>
                <select name="priority" id="priority" aria-label="Priority">
                    <option selected value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
                <label for="dueDate">Due Date</label>
                <input type="date" id="dueDate" name="deadline">
                <button type="submit" class="submit-btn">Create</button>
            </form>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/modal.js') }}"></script>
    <div id="main">
        <div id="categories"></div>
        <div id="taskPanel">
            {# TODO: Proper grouping #}
            <article class="group">
                <header>
                    <h2>Tasks</h2>
                </header>
                {% for task in tasks %}
                    <a class="task priority-{{ task.priority }}"
                       href="/project/{{ project.id }}/category/{{ category.id }}/task/{{ task.task_id }}">
                        <article>
                            <h3>{{ task.task_name }}</h3>
                            <div class="taskFooter">
                                <div role="group">
                                    {% if task.task_description %}
                                        <span class="material-symbols-outlined" title="Has Description">description</span>
                                    {% endif %}
                                    <div class="userIcons">
                                        {% if task.assigned_user_ids %}
                                            {% set users = task.assigned_user_ids.split(',') %}
                                            {% for user in users[:3] %}
                                                {% set parts = user.split(':') %}
                                                {% set user_id = parts[0] %}
                                                {% set user_name = parts[1] %}
                                                <img src="/user/{{ user_id }}/icon"
                                                     alt="User {{ user_name }}"
                                                     class="user-icon"
                                                     height="64"
                                                     width="64"
                                                     aria-label="{{ user_name }}">
                                            {% endfor %}
                                            {% if users|length > 3 %}<span class="ellipsis">…</span>{% endif %}
                                        {% else %}
                                            <span class="no-users">No users assigned</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </article>
                    </a>
                {% endfor %}
            </article>
        </div>
    </div>
{% endblock content %}
