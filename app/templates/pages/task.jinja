{#=====================================================
  Home page
  - Hero style greeting banner
  - List of things passed in as 'things' array
  - Form for adding a new thing
=====================================================#}
{% extends "pages/base.jinja" %}
{% block title %}
    TaskForge - {{ task.task_name }}
{% endblock title %}
{% block nav_left %}
    {% if project.owner == session.userid %}
        <li>
            <button id="p-open-add-user" data-project-id="{{ project.id }}">
                <span class="material-symbols-outlined">group_add</span>
            </button>
        </li>
        <dialog id="p-add-user-modal">
            <article>
                <header>
                    <h3>Add user to project</h3>
                </header>
                <input id="p-member-input"
                       type="text"
                       placeholder="Type a username..."
                       autocomplete="off">
                <output id="p-add-user-error" role="status"></output>
                <footer>
                    <button id="p-cancel-add-user" class="secondary">Cancel</button>
                    <button id="p-confirm-add-user">Add</button>
                </footer>
            </article>
        </dialog>
        <script src="{{ url_for('static', filename='js/project_add_user_modal.js') }}"></script>
    {% endif %}
{% endblock nav_left %}
{% block nav_centre %}
    <li>
        <h3>
            <a href="/project/{{ project.id }}/category/{{ category.id }}">{{ project.name }}</a>
        </h3>
    </li>
    <li>
        <h3>
            <span class="weak">{{ task.task_name }}</span>
        </h3>
    </li>
{% endblock nav_centre %}
{% block content %}
    <div id="fluid">
        <article class="taskMain">
            <header>
                <h3>{{ task.task_name }}</h3>
            </header>
            <textarea id="task-description"
                      rows="8"
                      data-task-id="{{ task.task_id }}"
                      placeholder="Edit Description...">{{task.task_description}}</textarea>
            <script src="{{ url_for('static', filename='js/description.js') }}"></script>
            <footer>
                <div role="group">
                    <div class="userIcons">
                        {% set users = task.assigned_users | from_json %}
                        {% if users %}
                            {% for user in users[:8] %}
                                <a href="/user/{{ user.id }}/profile" data-tooltip="{{ user.username }}">
                                    <img src="/user/{{ user.id }}/icon"
                                         alt="{{ user.username }}"
                                         class="user-icon"
                                         height="64"
                                         width="64">
                                </a>
                            {% endfor %}
                            {% if users|length > 8 %}<span class="ellipsis">…</span>{% endif %}
                        {% else %}
                            <span class="no-users">No users assigned</span>
                        {% endif %}
                        <!-- Trigger button -->
                        <button id="open-add-user"
                                data-task-id="{{ task.task_id }}"
                                data-project-id="{{ project.id }}">
                            <span class="material-symbols-outlined">person_add</span>
                        </button>
                        <!-- Modal -->
                        <dialog id="add-user-modal">
                            <article>
                                <header>
                                    <h3>Add user to task</h3>
                                </header>
                                <label for="member-input">Search project members</label>
                                <input id="member-input"
                                       type="text"
                                       placeholder="Start typing a username…"
                                       list="project-members"
                                       autocomplete="off">
                                <datalist id="project-members"></datalist>
                                <output id="add-user-error" role="status"></output>
                                <footer>
                                    <button id="cancel-add-user" class="secondary">Cancel</button>
                                    <button id="confirm-add-user">Add</button>
                                </footer>
                            </article>
                        </dialog>
                        <!-- Load your external JS -->
                        <script src="{{ url_for('static', filename='js/add_user_modal.js') }}"></script>
                    </div>
                    <form action="/project/{{ project.id }}/category/{{ category.id }}/task/{{ task.task_id }}/complete"
                          method="post">
                        <button type="submit" class="complete-btn">
                            <span class="material-symbols-outlined">
                                {% if task.task_completed_timestamp %}
                                    check_box
                                {% else %}
                                    check_box_outline_blank
                                {% endif %}
                            </span>
                            {% if task.task_completed_timestamp %}
                                Mark as Incomplete
                            {% else %}
                                Mark as Complete
                            {% endif %}
                        </button>
                    </form>
                </div>
            </footer>
        </article>
    </div>
{% endblock content %}
